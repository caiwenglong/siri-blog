<!--
   动态菜单 item 递归实现
   myRouter ： 菜单列表
   initLevel ： 菜单初始化缩进等级
   bgColorLevel ：菜单背景色
   basePath : 上级菜单
   author ： ths
-->
<template>
  <div>

    <template v-for="(item,index) in myRouter">
      <template v-if="item.meta.isHidden !== true">
        <q-item-label
          v-if="item.meta.itemLabel"
          :key="item.meta.itemLabel"
          header
          class="text-weight-bold text-uppercase"
        >
          {{ item.meta.itemLabel }}
        </q-item-label>

        <!-- 没有孩子 -->
        <q-item
          v-if="!item.children"
          :key="index"
          v-ripple
          exact
          :class="bgColor + '-' + bgColorLevel"
          :inset-level="initLevel"
          :to="handleLink(basePath, item.path)"
          clickable
          @click="externalLink(basePath, item.path)"
        >
          <q-item-section avatar>
            <q-icon :name="item.meta.icon" />
          </q-item-section>
          <q-item-section>{{ item.meta.title }}</q-item-section>
        </q-item>

        <!-- 有孩子 -->
        <q-expansion-item
          v-else
          :key="index"
          :duration="duration"
          :class="bgColor + '-' + bgColorLevel"
          :default-opened="item.meta.isOpen"
          :header-inset-level="initLevel"
          :icon="item.meta.icon"
          :label="item.meta.title"
          tag="div"
        >

          <!-- 菜单项缩进 + 0.3 ; 背景色深度 + 1 ; 如果上级菜单路径存在，则拼接上级菜单路径 -->
          <base-menu-item
            :my-router="item.children"
            :init-level="initLevel + 0.2"
            :bg-color-level="bgColorLevel+1"
            :bg-color="bgColor"
            :base-path="basePath === undefined ? item.path : basePath + '/' + item.path"
          />

        </q-expansion-item>
      </template>
    </template>

  </div>
</template>

<script>
export default {
  name: 'BaseMenuItem',
  // eslint-disable-next-line vue/require-prop-types
  props: ['myRouter', 'initLevel', 'bgColor', 'bgColorLevel', 'duration', 'basePath'],
  methods: {

    /**
     * 处理内部链接
     * @param basePath
     * @param itemPath
     */
    handleLink(basePath, itemPath) {
      const link = basePath === undefined ? itemPath : basePath + '/' + itemPath
      if (link.indexOf('http') !== -1) {
        return '#'
      }
      return link
    },

    /**
     * 处理外部链接
     * @param basePath
     * @param itemPath
     * @returns {boolean}
     */
    externalLink(basePath, itemPath) {
      const link = basePath === undefined ? itemPath : basePath + '/' + itemPath
      const i = link.indexOf('http')
      if (i !== -1) {
        const a = document.createElement('a')
        a.setAttribute('href', link.slice(i))
        a.setAttribute('target', '_blank')
        a.click()
        return false
      }
    }

  }
}
</script>
